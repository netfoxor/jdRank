<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta http-equiv="Cache-Control" content="no-transform"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
    <title>Title</title>
    <script src="js/echarts.js"></script>
    <script src="js/jquery-3.3.1.js"></script>
</head>
<body>
<style>
    body {
        width: 640px;
    }

    body, input {
        font-size: 18px;
    }

    input {
        border: 1px solid gray;
        font-size: 18px;
    }
</style>
<div>
    <form class="j-search-form">
        <div><label>品牌：<input type="text" name="brand"></label></div>
        <div><label>榜单：<input type="text" name="sort"></label></div>
        <div><label>开始时间：<input type="text" name="beginDateStr"></label></div>
        <div><input class="j-request" type="button" value="请求"></div>
    </form>
</div>
<div id="main" style="width: 1024px;height:600px;"></div>
<script type="text/javascript">

  function refreshCharts() {
    var query = '';
    $('.j-search-form input').each(function (index, item) {
      var name = $(item).attr('name');
      var value = $(item).val();
      if (name && value) {
        query += '&' + name + '=' + value;
        localStorage.setItem('form-' + name, value);
      }
    });
    const keywords = ['女童连衣裙', '女童连衣裙夏', '女童连衣裙夏装', '女童裙子', '儿童连衣裙', '儿童裙子', '亲子装', '亲子套装', '全家装', '亲子装全家装', '亲子装全家装 夏装'];
    keywords.map(function (keyword) {
      fetch("/api?" + query + "&keyword=" + keyword)
        .then(
          function (response) {
            if (response.status !== 200) {
              console.log("存在一个问题，状态码为：" + response.status);
              return;
            }
            //检查响应文本
            response.json().then(function (data) {
              console.log(data);
              updateCharts('c_' + keyword, data);
            });
          }
        )
        .catch(function (err) {
          console.log("Fetch错误:" + err);
        });
    });
  }

  function updateCharts(chartName, response) {
    myChart = getCharts(chartName);
    var option = {
      title: {
        text: chartName
      },
      tooltip: {
        trigger: 'axis'
      },
      legend: {
        data: response.skuIds
      },
      dataZoom: [{
        type: 'inside'
      }],
      xAxis: {
        data: response.xAxis
      },
      yAxis: {
        inverse: true,
        min: 1
      },
      series: response.series
    };
    myChart.clear();
    myChart.setOption(option);
  };

  function getCharts(chartName) {
    if ($('#' + chartName).length === 0) {
      var $div = $('div').attr('id', chartName);
      $('body').append($div);
      var chart = echarts.init($div[0]);
      return chart;
    } else {
      return $('#' + chartName)[0];
    }

  }

  $('.j-search-form input').each(function (index, item) {
    var name = $(item).attr('name');
    var value = localStorage.getItem('form-' + name);
    if (name && value) {
      $(item).val(value);
    }
  });

  $('.j-request').on('click', function () {
    refreshCharts();
  });
</script>
</body>
</html>