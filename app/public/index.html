<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta http-equiv="Cache-Control" content="no-transform"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
    <title>Title</title>
    <script src="js/echarts.js"></script>
    <script src="js/jquery-3.3.1.js"></script>
</head>
<body>
<style>
    body, input {
        font-size: 18px;
    }

    input {
        border: 1px solid gray;
        font-size: 18px;
    }

    .chart {
        display: inline-block;
        width: 600px;
        height: 300px;
        padding: 5px;
        border: 1px solid gray;
    }
</style>
<div>
    <form class="j-search-form">
        <div><label>标题关键字：<input type="text" name="brand"></label></div>
        <div><label>开始时间：<input type="text" name="beginDateStr"></label></div>
        <div><input class="j-request" type="button" value="刷新"></div>
    </form>
</div>
<script type="text/javascript">

  var CHARTS = {};

  function refreshCharts() {
    var query = '';
    $('.j-search-form input').each(function (index, item) {
      var name = $(item).attr('name');
      var value = $(item).val();
      if (name) {
        query += '&' + name + '=' + value;
        localStorage.setItem('form-' + name, value);
      }
    });
    const keywords = ['女童连衣裙', '女童连衣裙夏', '女童连衣裙夏装', '女童裙子', '儿童连衣裙', '儿童裙子', '亲子装', '亲子套装', '全家装', '亲子装全家装', '亲子装全家装 夏装'];
    keywords.map(function (keyword) {
      ['综合榜', '销量榜'].map(function (sortName, index) {
        var chartName = '报表-' + keyword + '-' + sortName;
        getChartInstanse(chartName);
        fetch("/api?" + query + "&keyword=" + keyword + "&sort=" + index)
          .then(
            function (response) {
              if (response.status !== 200) {
                console.log("存在一个问题，状态码为：" + response.status);
                return;
              }
              //检查响应文本
              response.json().then(function (data) {
                console.log(data);
                updateCharts(chartName, data);
              });
            }
          )
          .catch(function (err) {
            console.log("Fetch错误:" + err);
          });
      });
    })
  }

  function updateCharts(chartName, response) {
    var myChart = getChartInstanse(chartName);
    var option = {
      title: {
        text: chartName
      },
      tooltip: {
        trigger: 'axis'
      },
      legend: {
        data: response.skuIds
      },
      dataZoom: [{
        type: 'inside'
      }],
      xAxis: {
        data: response.xAxis
      },
      yAxis: {
        inverse: true,
        min: 1
      },
      series: response.series
    };
    myChart && myChart.clear && myChart.clear();
    myChart.setOption(option);
  }

  function getChartInstanse(chartName) {
    if (!CHARTS[chartName]) {
      var $div = $('<div class="chart">');
      $('body').append($div);
      var chart = echarts.init($div[0]);
      CHARTS[chartName] = chart;
    }
    return CHARTS[chartName];
  }

  $('.j-search-form input').each(function (index, item) {
    var name = $(item).attr('name');
    var value = localStorage.getItem('form-' + name);
    if (name && value) {
      $(item).val(value);
    }
  });

  $('.j-request').on('click', function () {
    refreshCharts();
  });
</script>
</body>
</html>